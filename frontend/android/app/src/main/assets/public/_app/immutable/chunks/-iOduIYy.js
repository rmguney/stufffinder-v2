import{g as s}from"./RSIJn0f_.js";import{a as m}from"./OLZfEaQC.js";import{w as l}from"./Crv6Zvwd.js";import{v as w}from"./DhMr5c2G.js";const n=l([]),k=l(0);let f="";function g(t){const o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}async function i(){try{if(!g("tokenKey"))return;m.subscribe(h=>{f=h});const e=f;if(!e)return;const o=await fetch(`https://backend-310608491068.europe-west1.run.app/api/auth/username/${e}`,{headers:s()});if(!o.ok)throw new Error("Failed to get user ID");const d=(await o.json()).userId,c=await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${d}`,{headers:s()});if(!c.ok)throw new Error("Failed to fetch notifications");const u=await c.json();n.set(u),p(u)}catch(t){console.error("Error fetching notifications:",t)}}async function b(t){try{if(!(await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${t}/read`,{method:"PUT",headers:s()})).ok)throw new Error("Failed to mark notification as read");n.update(o=>o.map(a=>a.id===t?{...a,isRead:!0}:a)),n.subscribe(o=>{p(o)})()}catch(e){console.error("Error marking notification as read:",e)}}async function E(){try{console.log(n);const t=w(n);for(const e of t)e.isRead||await b(e.id);i()}catch(t){console.error("Error marking all notifications as read:",t)}}function p(t){const e=t.filter(o=>!o.isRead).length;k.set(e)}let r;function $(){r&&clearInterval(r),i(),r=setInterval(i,6e4)}function A(){r&&(clearInterval(r),r=null)}export{E as a,$ as b,i as f,b as m,n,A as s,k as u};
