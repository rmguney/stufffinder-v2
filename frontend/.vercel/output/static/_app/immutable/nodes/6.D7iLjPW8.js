import{s as ze,e as E,c as S,b as A,f as p,l as w,i as C,D as Ve,a as P,g as B,h as $,t as K,E as ae,d as J,p as ce,F as le,y as ye,j as x,z as Ze,m as Ne,o as Le,k as ke,S as We,q as Oe}from"../chunks/BgXtprSQ.js";import{S as Me,i as Fe,c as N,a as L,m as M,t as b,b as y,d as F,g as ee,f as te,e as Re}from"../chunks/1qaseQuG.js";import{C as fe,P as ne,e as ie,u as He,o as Ye,a as qe}from"../chunks/Cw2352T2.js";import{T as Ke}from"../chunks/Cr7Yvov7.js";import{a as Je}from"../chunks/BdYHp-EM.js";import{a as Ge}from"../chunks/BA0DiF7A.js";import{C as de}from"../chunks/BqBYWKmR.js";import{P as Qe}from"../chunks/CDF5JEGi.js";import{S as xe}from"../chunks/DQRmeOpa.js";import{g as me}from"../chunks/RSIJn0f_.js";import{B as ue}from"../chunks/BfJTMMYn.js";import{u as et,t as Ce}from"../chunks/DqEw4LiL.js";function tt({params:s}){return{id:s.id}}const Nt=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));function je(s,e,t){const r=s.slice();return r[26]=e[t],r}function Ie(s){let e,t="•",r,n,o=`<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
              Best Answer`;return{c(){e=E("span"),e.textContent=t,r=P(),n=E("span"),n.innerHTML=o,this.h()},l(u){e=S(u,"SPAN",{"data-svelte-h":!0}),ce(e)!=="svelte-7hh8jk"&&(e.textContent=t),r=B(u),n=S(u,"SPAN",{class:!0,"data-svelte-h":!0}),ce(n)!=="svelte-zlbtxx"&&(n.innerHTML=o),this.h()},h(){w(n,"class","text-teal-800 dark:text-teal-600 font-medium flex items-center gap-1")},m(u,a){C(u,e,a),C(u,r,a),C(u,n,a)},d(u){u&&(p(e),p(r),p(n))}}}function rt(s){let e,t,r=(s[7]||"Anonymous")+"",n,o,u,a,l="•",f,c,v=s[18](s[8])+"",_,h,g,m,i=(s[6]||"No content")+"",j,O,T,X,z,Z,k,V,R,Y=s[1]-s[2]+"",G,d,I,H,W,Q,oe,se,q=s[0]&&Ie();return{c(){e=E("div"),t=E("a"),n=K(r),u=P(),a=E("span"),a.textContent=l,f=P(),c=E("span"),_=K(v),h=P(),q&&q.c(),g=P(),m=E("div"),j=K(i),O=P(),T=E("div"),X=E("button"),z=ae("svg"),Z=ae("path"),V=P(),R=E("span"),G=K(Y),d=P(),I=E("button"),H=ae("svg"),W=ae("path"),this.h()},l(D){e=S(D,"DIV",{class:!0});var U=A(e);t=S(U,"A",{href:!0,class:!0});var pe=A(t);n=J(pe,r),pe.forEach(p),u=B(U),a=S(U,"SPAN",{"data-svelte-h":!0}),ce(a)!=="svelte-7hh8jk"&&(a.textContent=l),f=B(U),c=S(U,"SPAN",{});var he=A(c);_=J(he,v),he.forEach(p),h=B(U),q&&q.l(U),U.forEach(p),g=B(D),m=S(D,"DIV",{class:!0});var _e=A(m);j=J(_e,i),_e.forEach(p),O=B(D),T=S(D,"DIV",{class:!0});var re=A(T);X=S(re,"BUTTON",{class:!0});var ge=A(X);z=le(ge,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var ve=A(z);Z=le(ve,"path",{d:!0}),A(Z).forEach(p),ve.forEach(p),ge.forEach(p),V=B(re),R=S(re,"SPAN",{class:!0});var be=A(R);G=J(be,Y),be.forEach(p),d=B(re),I=S(re,"BUTTON",{class:!0});var $e=A(I);H=le($e,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var we=A(H);W=le(we,"path",{d:!0}),A(W).forEach(p),we.forEach(p),$e.forEach(p),re.forEach(p),this.h()},h(){w(t,"href",o=`/user/${s[7]}`),w(t,"class","font-medium hover:text-rose-900 hover:underline"),w(e,"class","flex flex-wrap items-center gap-2 text-sm text-gray-600 mb-2"),w(m,"class","text-neutral-900 dark:text-neutral-100"),w(Z,"d","M5 14l5-5 5 5H5z"),w(z,"xmlns","http://www.w3.org/2000/svg"),w(z,"class","h-5 w-5"),w(z,"viewBox","0 0 20 20"),w(z,"fill","currentColor"),w(X,"class",k="flex items-center justify-center hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full w-8 h-8 transition-colors "+(s[3]?"text-teal-600":"text-gray-600")),w(R,"class","text-sm font-medium"),w(W,"d","M5 6l5 5 5-5H5z"),w(H,"xmlns","http://www.w3.org/2000/svg"),w(H,"class","h-5 w-5"),w(H,"viewBox","0 0 20 20"),w(H,"fill","currentColor"),w(I,"class",Q="flex items-center justify-center hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full w-8 h-8 transition-colors "+(s[4]?"text-rose-600":"text-gray-500")),w(T,"class","flex items-center gap-2 mt-3")},m(D,U){C(D,e,U),$(e,t),$(t,n),$(e,u),$(e,a),$(e,f),$(e,c),$(c,_),$(e,h),q&&q.m(e,null),C(D,g,U),C(D,m,U),$(m,j),C(D,O,U),C(D,T,U),$(T,X),$(X,z),$(z,Z),$(T,V),$(T,R),$(R,G),$(T,d),$(T,I),$(I,H),$(H,W),oe||(se=[ye(X,"click",s[22]),ye(I,"click",s[23])],oe=!0)},p(D,U){U&128&&r!==(r=(D[7]||"Anonymous")+"")&&x(n,r),U&128&&o!==(o=`/user/${D[7]}`)&&w(t,"href",o),U&256&&v!==(v=D[18](D[8])+"")&&x(_,v),D[0]?q||(q=Ie(),q.c(),q.m(e,null)):q&&(q.d(1),q=null),U&64&&i!==(i=(D[6]||"No content")+"")&&x(j,i),U&8&&k!==(k="flex items-center justify-center hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full w-8 h-8 transition-colors "+(D[3]?"text-teal-600":"text-gray-600"))&&w(X,"class",k),U&6&&Y!==(Y=D[1]-D[2]+"")&&x(G,Y),U&16&&Q!==(Q="flex items-center justify-center hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full w-8 h-8 transition-colors "+(D[4]?"text-rose-600":"text-gray-500"))&&w(I,"class",Q)},d(D){D&&(p(e),p(g),p(m),p(O),p(T)),q&&q.d(),oe=!1,Ze(se)}}}function De(s){let e,t;return e=new ue({props:{variant:"outline",class:"text-xs py-1 px-3 hover:bg-neutral-100 dark:hover:bg-neutral-800",$$slots:{default:[nt]},$$scope:{ctx:s}}}),e.$on("click",s[19]),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&536870912&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function nt(s){let e;return{c(){e=K("Mark as Best Answer")},l(t){e=J(t,"Mark as Best Answer")},m(t,r){C(t,e,r)},d(t){t&&p(e)}}}function ot(s){let e=s[12]?"Cancel":"Reply",t;return{c(){t=K(e)},l(r){t=J(r,e)},m(r,n){C(r,t,n)},p(r,n){n&4096&&e!==(e=r[12]?"Cancel":"Reply")&&x(t,e)},d(r){r&&p(t)}}}function Ae(s){let e,t,r,n,o,u;function a(f){s[24](f)}let l={class:"w-full p-2 border rounded-lg text-sm bg-white dark:bg-neutral-800 border-neutral-200 dark:border-neutral-700",placeholder:"Write your reply..."};return s[13]!==void 0&&(l.value=s[13]),t=new Ke({props:l}),Ne.push(()=>Re(t,"value",a)),o=new ue({props:{class:"mt-2 text-xs py-1 px-3 hover:bg-rose-900",$$slots:{default:[st]},$$scope:{ctx:s}}}),o.$on("click",s[16]),{c(){e=E("div"),N(t.$$.fragment),n=P(),N(o.$$.fragment),this.h()},l(f){e=S(f,"DIV",{class:!0});var c=A(e);L(t.$$.fragment,c),n=B(c),L(o.$$.fragment,c),c.forEach(p),this.h()},h(){w(e,"class","p-4 pt-0")},m(f,c){C(f,e,c),M(t,e,null),$(e,n),M(o,e,null),u=!0},p(f,c){const v={};!r&&c&8192&&(r=!0,v.value=f[13],Le(()=>r=!1)),t.$set(v);const _={};c&536870912&&(_.$$scope={dirty:c,ctx:f}),o.$set(_)},i(f){u||(b(t.$$.fragment,f),b(o.$$.fragment,f),u=!0)},o(f){y(t.$$.fragment,f),y(o.$$.fragment,f),u=!1},d(f){f&&p(e),F(t),F(o)}}}function st(s){let e;return{c(){e=K("Submit Reply")},l(t){e=J(t,"Submit Reply")},m(t,r){C(t,e,r)},d(t){t&&p(e)}}}function Ee(s){let e,t=[],r=new Map,n,o=ie(s[10]);const u=a=>a[26].id;for(let a=0;a<o.length;a+=1){let l=je(s,o,a),f=u(l);r.set(f,t[a]=Se(f,l))}return{c(){e=E("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=S(a,"DIV",{class:!0});var l=A(e);for(let f=0;f<t.length;f+=1)t[f].l(l);l.forEach(p),this.h()},h(){w(e,"class","pl-4 border-l-2 border-neutral-200 dark:border-neutral-700 ml-4 mb-4")},m(a,l){C(a,e,l);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,l){l&3616&&(o=ie(a[10]),ee(),t=He(t,l,u,1,a,o,r,e,Ye,Se,null,je),te())},i(a){if(!n){for(let l=0;l<o.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)y(t[l]);n=!1},d(a){a&&p(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Se(s,e){let t,r,n,o;return r=new Xe({props:{threadId:e[11],commentId:e[26].id,comment:e[26].content,commentator:e[26].author,postedDateComment:e[26].createdAt,selected:e[26].bestAnswer||!1,threadOwner:e[9],replies:e[26].replies||[],upvotes:e[26].upvotes,downvotes:e[26].downvotes,userUpvoted:e[26].userUpvoted,userDownvoted:e[26].userDownvoted,parentCommentId:e[5]}}),{key:s,first:null,c(){t=E("div"),N(r.$$.fragment),n=P(),this.h()},l(u){t=S(u,"DIV",{class:!0});var a=A(t);L(r.$$.fragment,a),n=B(a),a.forEach(p),this.h()},h(){w(t,"class","mt-2"),this.first=t},m(u,a){C(u,t,a),M(r,t,null),$(t,n),o=!0},p(u,a){e=u;const l={};a&2048&&(l.threadId=e[11]),a&1024&&(l.commentId=e[26].id),a&1024&&(l.comment=e[26].content),a&1024&&(l.commentator=e[26].author),a&1024&&(l.postedDateComment=e[26].createdAt),a&1024&&(l.selected=e[26].bestAnswer||!1),a&512&&(l.threadOwner=e[9]),a&1024&&(l.replies=e[26].replies||[]),a&1024&&(l.upvotes=e[26].upvotes),a&1024&&(l.downvotes=e[26].downvotes),a&1024&&(l.userUpvoted=e[26].userUpvoted),a&1024&&(l.userDownvoted=e[26].userDownvoted),a&32&&(l.parentCommentId=e[5]),r.$set(l)},i(u){o||(b(r.$$.fragment,u),o=!0)},o(u){y(r.$$.fragment,u),o=!1},d(u){u&&p(t),F(r)}}}function at(s){let e,t,r,n,o,u,a,l,f,c,v;t=new de({props:{class:"p-4",$$slots:{default:[rt]},$$scope:{ctx:s}}}),n=new xe({});let _=s[14]&&!s[0]&&De(s);l=new ue({props:{variant:"outline",class:"text-xs py-1 px-3 hover:bg-neutral-100 dark:hover:bg-neutral-800",$$slots:{default:[ot]},$$scope:{ctx:s}}}),l.$on("click",s[15]);let h=s[12]&&Ae(s),g=s[10]&&s[10].length>0&&Ee(s);return{c(){e=E("div"),N(t.$$.fragment),r=P(),N(n.$$.fragment),o=P(),u=E("div"),_&&_.c(),a=P(),N(l.$$.fragment),f=P(),h&&h.c(),c=P(),g&&g.c(),this.h()},l(m){e=S(m,"DIV",{class:!0});var i=A(e);L(t.$$.fragment,i),r=B(i),L(n.$$.fragment,i),o=B(i),u=S(i,"DIV",{class:!0});var j=A(u);_&&_.l(j),a=B(j),L(l.$$.fragment,j),j.forEach(p),f=B(i),h&&h.l(i),c=B(i),g&&g.l(i),i.forEach(p),this.h()},h(){w(u,"class","p-4 flex flex-wrap gap-2"),w(e,"class","flex flex-col w-full")},m(m,i){C(m,e,i),M(t,e,null),$(e,r),M(n,e,null),$(e,o),$(e,u),_&&_.m(u,null),$(u,a),M(l,u,null),$(e,f),h&&h.m(e,null),$(e,c),g&&g.m(e,null),v=!0},p(m,i){const j={};i&536871391&&(j.$$scope={dirty:i,ctx:m}),t.$set(j),m[14]&&!m[0]?_?(_.p(m,i),i&16385&&b(_,1)):(_=De(m),_.c(),b(_,1),_.m(u,a)):_&&(ee(),y(_,1,1,()=>{_=null}),te());const O={};i&536875008&&(O.$$scope={dirty:i,ctx:m}),l.$set(O),m[12]?h?(h.p(m,i),i&4096&&b(h,1)):(h=Ae(m),h.c(),b(h,1),h.m(e,c)):h&&(ee(),y(h,1,1,()=>{h=null}),te()),m[10]&&m[10].length>0?g?(g.p(m,i),i&1024&&b(g,1)):(g=Ee(m),g.c(),b(g,1),g.m(e,null)):g&&(ee(),y(g,1,1,()=>{g=null}),te())},i(m){v||(b(t.$$.fragment,m),b(n.$$.fragment,m),b(_),b(l.$$.fragment,m),b(h),b(g),v=!0)},o(m){y(t.$$.fragment,m),y(n.$$.fragment,m),y(_),y(l.$$.fragment,m),y(h),y(g),v=!1},d(m){m&&p(e),F(t),F(n),_&&_.d(),F(l),h&&h.d(),g&&g.d()}}}function lt(s){let e,t,r;return t=new fe({props:{class:`w-full bg-opacity-90 hover:bg-opacity-100 relative ${s[0]?"border-2 border-teal-600 dark:border-teal-800":""}`,$$slots:{default:[at]},$$scope:{ctx:s}}}),{c(){e=E("div"),N(t.$$.fragment),this.h()},l(n){e=S(n,"DIV",{class:!0});var o=A(e);L(t.$$.fragment,o),o.forEach(p),this.h()},h(){w(e,"class","flex w-full py-1")},m(n,o){C(n,e,o),M(t,e,null),r=!0},p(n,[o]){const u={};o&1&&(u.class=`w-full bg-opacity-90 hover:bg-opacity-100 relative ${n[0]?"border-2 border-teal-600 dark:border-teal-800":""}`),o&536903679&&(u.$$scope={dirty:o,ctx:n}),t.$set(u)},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){y(t.$$.fragment,n),r=!1},d(n){n&&p(e),F(t)}}}function it(s){const t=`; ${document.cookie}`.split(`; ${s}=`);return t.length===2?t.pop().split(";").shift():null}function ft(s,e,t){let{commentId:r}=e,{comment:n}=e,{commentator:o}=e,{postedDateComment:u}=e,{selected:a=!1}=e,{threadOwner:l}=e,{replies:f=[]}=e,{threadId:c}=e,{upvotes:v=0}=e,{downvotes:_=0}=e,{userUpvoted:h=!1}=e,{userDownvoted:g=!1}=e,{parentCommentId:m=null}=e,i=null,j=!1,O="",T=!1;Ve(()=>{typeof n=="object"&&n!==null&&(t(1,v=n.upvotes||0),t(2,_=n.downvotes||0),t(3,h=n.userUpvoted||!1),t(4,g=n.userDownvoted||!1)),f&&f.length>0&&f.forEach(d=>{}),(f==null?void 0:f.length)>0});const X=()=>{t(12,j=!j)},z=async()=>{if(O.trim())try{const d=me();if(!d.Authorization){console.error("Please log in to reply");return}const I={content:O,postId:c,parentCommentId:r},H=await fetch(`${ne}/api/comments/create`,{method:"POST",headers:{"Content-Type":"application/json",...d},body:JSON.stringify(I)});if(!H.ok){const Q=await H.text();throw new Error(`Failed to add reply: ${Q}`)}const W=await H.json();t(13,O=""),t(12,j=!1),document.dispatchEvent(new CustomEvent("refreshComments",{bubbles:!0,detail:{threadId:c}}))}catch(d){console.error("Error adding reply:",d)}},Z=async d=>{try{const I=me();if(!I.Authorization){console.error("Please log in to vote");return}const H=await fetch(`${ne}/api/comments/${d?"upvote":"downvote"}/${r}`,{method:"POST",headers:{"Content-Type":"application/json",...I}});if(!H.ok)throw new Error(`Vote failed: ${H.status}`);const W=await H.json();W&&(t(1,v=W.upvotes||v),t(2,_=W.downvotes||_),t(3,h=d),t(4,g=!d))}catch(I){console.error("Error voting:",I)}},k=d=>{if(!d)return"";const I=new Date(d),H={hour:"numeric",minute:"numeric",hour12:!1},W=new Intl.DateTimeFormat("en-US",H).format(I),Q=I.getDate(),oe=I.toLocaleString("en-US",{month:"short"}),se=I.getFullYear();return`${W}, ${Q} ${oe} ${se}`},V=async()=>{try{if(!T){console.error("Only the thread owner can mark best answers");return}const d=it("tokenKey");if(!d){console.error("No auth token found");return}const I=await fetch(`${ne}/api/posts/${c}/markBestAnswer/${r}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(I.status===403){console.error("You don't have permission to mark best answers");return}if(!I.ok)throw new Error(`Failed to mark best answer: ${I.status}`);t(0,a=!a),document.dispatchEvent(new CustomEvent("refreshComments",{bubbles:!0,detail:{threadId:c}}))}catch(d){console.error("Error toggling best answer status:",d)}};console.log(`Comment ${r} replies:`,f);const R=()=>Z(!0),Y=()=>Z(!1);function G(d){O=d,t(13,O)}return s.$$set=d=>{"commentId"in d&&t(5,r=d.commentId),"comment"in d&&t(6,n=d.comment),"commentator"in d&&t(7,o=d.commentator),"postedDateComment"in d&&t(8,u=d.postedDateComment),"selected"in d&&t(0,a=d.selected),"threadOwner"in d&&t(9,l=d.threadOwner),"replies"in d&&t(10,f=d.replies),"threadId"in d&&t(11,c=d.threadId),"upvotes"in d&&t(1,v=d.upvotes),"downvotes"in d&&t(2,_=d.downvotes),"userUpvoted"in d&&t(3,h=d.userUpvoted),"userDownvoted"in d&&t(4,g=d.userDownvoted),"parentCommentId"in d&&t(20,m=d.parentCommentId)},s.$$.update=()=>{s.$$.dirty&2097664&&Je.subscribe(d=>{t(21,i=d),t(14,T=i===l)}),s.$$.dirty&1024&&f&&f.length>0,s.$$.dirty&1024&&(f==null?void 0:f.length)>0,s.$$.dirty&1024&&f&&f.length>0},[a,v,_,h,g,r,n,o,u,l,f,c,j,O,T,X,z,Z,k,V,m,i,R,Y,G]}class Xe extends Me{constructor(e){super(),Fe(this,e,ft,lt,ze,{commentId:5,comment:6,commentator:7,postedDateComment:8,selected:0,threadOwner:9,replies:10,threadId:11,upvotes:1,downvotes:2,userUpvoted:3,userDownvoted:4,parentCommentId:20})}}function Te(s,e,t){const r=s.slice();return r[13]=e[t],r}function Ue(s){let e,t;return e=new Qe({props:{id:s[0].id,title:s[1].title,description:s[1].description,tags:s[1].tags,mysteryObject:s[1].mysteryObject,imageSrc:s[1].mysteryObjectImage?`data:image/png;base64,${s[1].mysteryObjectImage}`:"",postedBy:s[1].author,postedDate:s[1].createdAt,upvotes:s[1].upvotes,downvotes:s[1].downvotes,userUpvoted:s[1].userUpvoted,userDownvoted:s[1].userDownvoted,createdAt:s[1].createdAt,updatedAt:s[1].updatedAt,solved:s[1].solved,variant:"thread"}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&1&&(o.id=r[0].id),n&2&&(o.title=r[1].title),n&2&&(o.description=r[1].description),n&2&&(o.tags=r[1].tags),n&2&&(o.mysteryObject=r[1].mysteryObject),n&2&&(o.imageSrc=r[1].mysteryObjectImage?`data:image/png;base64,${r[1].mysteryObjectImage}`:""),n&2&&(o.postedBy=r[1].author),n&2&&(o.postedDate=r[1].createdAt),n&2&&(o.upvotes=r[1].upvotes),n&2&&(o.downvotes=r[1].downvotes),n&2&&(o.userUpvoted=r[1].userUpvoted),n&2&&(o.userDownvoted=r[1].userDownvoted),n&2&&(o.createdAt=r[1].createdAt),n&2&&(o.updatedAt=r[1].updatedAt),n&2&&(o.solved=r[1].solved),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function ut(s){let e,t;return e=new fe({props:{class:"bg-opacity-90 hover:bg-opacity-100 mt-4",$$slots:{default:[pt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65536&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function ct(s){let e,t;return e=new fe({props:{class:"bg-opacity-90 hover:bg-opacity-100 p-4 mt-4 flex flex-col justify-center items-center",$$slots:{default:[_t]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65648&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function mt(s){let e;return{c(){e=K("Sign in to comment")},l(t){e=J(t,"Sign in to comment")},m(t,r){C(t,e,r)},d(t){t&&p(e)}}}function dt(s){let e,t;return e=new qe({props:{class:"text-lg text-center pb-6",$$slots:{default:[mt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65536&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function pt(s){let e,t;return e=new de({props:{$$slots:{default:[dt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65536&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Pe(s){let e,t;return{c(){e=E("p"),t=K(s[6]),this.h()},l(r){e=S(r,"P",{class:!0});var n=A(e);t=J(n,s[6]),n.forEach(p),this.h()},h(){w(e,"class","text-red-500 mt-2")},m(r,n){C(r,e,n),$(e,t)},p(r,n){n&64&&x(t,r[6])},d(r){r&&p(e)}}}function ht(s){let e=s[5]?"Sending...":"Send",t;return{c(){t=K(e)},l(r){t=J(r,e)},m(r,n){C(r,t,n)},p(r,n){n&32&&e!==(e=r[5]?"Sending...":"Send")&&x(t,e)},d(r){r&&p(t)}}}function _t(s){let e,t,r,n,o,u;function a(c){s[9](c)}let l={class:"w-full h-20 resize-none p-2",placeholder:"Say stuff"};s[4]!==void 0&&(l.value=s[4]),e=new Ke({props:l}),Ne.push(()=>Re(e,"value",a));let f=s[6]&&Pe(s);return o=new ue({props:{class:"mt-4 hover:bg-rose-900",disabled:s[5],$$slots:{default:[ht]},$$scope:{ctx:s}}}),o.$on("click",s[7]),{c(){N(e.$$.fragment),r=P(),f&&f.c(),n=P(),N(o.$$.fragment)},l(c){L(e.$$.fragment,c),r=B(c),f&&f.l(c),n=B(c),L(o.$$.fragment,c)},m(c,v){M(e,c,v),C(c,r,v),f&&f.m(c,v),C(c,n,v),M(o,c,v),u=!0},p(c,v){const _={};!t&&v&16&&(t=!0,_.value=c[4],Le(()=>t=!1)),e.$set(_),c[6]?f?f.p(c,v):(f=Pe(c),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null);const h={};v&32&&(h.disabled=c[5]),v&65568&&(h.$$scope={dirty:v,ctx:c}),o.$set(h)},i(c){u||(b(e.$$.fragment,c),b(o.$$.fragment,c),u=!0)},o(c){y(e.$$.fragment,c),y(o.$$.fragment,c),u=!1},d(c){c&&(p(r),p(n)),F(e,c),f&&f.d(c),F(o,c)}}}function gt(s){let e,t;return e=new fe({props:{class:"bg-opacity-90 hover:bg-opacity-100",$$slots:{default:[yt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65536&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function vt(s){let e=[],t=new Map,r,n,o=ie(s[2]);const u=a=>a[13].id;for(let a=0;a<o.length;a+=1){let l=Te(s,o,a),f=u(l);t.set(f,e[a]=Be(f,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=Oe()},l(a){for(let l=0;l<e.length;l+=1)e[l].l(a);r=Oe()},m(a,l){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(a,l);C(a,r,l),n=!0},p(a,l){l&7&&(o=ie(a[2]),ee(),e=He(e,l,u,1,a,o,t,r.parentNode,Ye,Be,r,Te),te())},i(a){if(!n){for(let l=0;l<o.length;l+=1)b(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)y(e[l]);n=!1},d(a){a&&p(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function bt(s){let e;return{c(){e=K("There are no comments yet")},l(t){e=J(t,"There are no comments yet")},m(t,r){C(t,e,r)},d(t){t&&p(e)}}}function $t(s){let e,t;return e=new qe({props:{class:"pb-2 text-lg text-center",$$slots:{default:[bt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(r){L(e.$$.fragment,r)},m(r,n){M(e,r,n),t=!0},p(r,n){const o={};n&65536&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function wt(s){let e;return{c(){e=K("Be the first to comment!")},l(t){e=J(t,"Be the first to comment!")},m(t,r){C(t,e,r)},d(t){t&&p(e)}}}function yt(s){let e,t,r,n;return e=new de({props:{$$slots:{default:[$t]},$$scope:{ctx:s}}}),r=new Ge({props:{class:"p-4 text-center",$$slots:{default:[wt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment),t=P(),N(r.$$.fragment)},l(o){L(e.$$.fragment,o),t=B(o),L(r.$$.fragment,o)},m(o,u){M(e,o,u),C(o,t,u),M(r,o,u),n=!0},p(o,u){const a={};u&65536&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const l={};u&65536&&(l.$$scope={dirty:u,ctx:o}),r.$set(l)},i(o){n||(b(e.$$.fragment,o),b(r.$$.fragment,o),n=!0)},o(o){y(e.$$.fragment,o),y(r.$$.fragment,o),n=!1},d(o){o&&p(t),F(e,o),F(r,o)}}}function Be(s,e){var u;let t,r,n,o;return r=new Xe({props:{threadId:e[0].id,commentId:e[13].id,comment:e[13].content,commentator:e[13].author,postedDateComment:e[13].createdAt,selected:e[13].bestAnswer||!1,threadOwner:(u=e[1])==null?void 0:u.author,replies:e[13].replies||[],upvotes:e[13].upvotes,downvotes:e[13].downvotes,userUpvoted:e[13].userUpvoted,userDownvoted:e[13].userDownvoted}}),{key:s,first:null,c(){t=E("div"),N(r.$$.fragment),n=P(),this.h()},l(a){t=S(a,"DIV",{class:!0});var l=A(t);L(r.$$.fragment,l),n=B(l),l.forEach(p),this.h()},h(){w(t,"class","mb-2"),this.first=t},m(a,l){C(a,t,l),M(r,t,null),$(t,n),o=!0},p(a,l){var c;e=a;const f={};l&1&&(f.threadId=e[0].id),l&4&&(f.commentId=e[13].id),l&4&&(f.comment=e[13].content),l&4&&(f.commentator=e[13].author),l&4&&(f.postedDateComment=e[13].createdAt),l&4&&(f.selected=e[13].bestAnswer||!1),l&2&&(f.threadOwner=(c=e[1])==null?void 0:c.author),l&4&&(f.replies=e[13].replies||[]),l&4&&(f.upvotes=e[13].upvotes),l&4&&(f.downvotes=e[13].downvotes),l&4&&(f.userUpvoted=e[13].userUpvoted),l&4&&(f.userDownvoted=e[13].userDownvoted),r.$set(f)},i(a){o||(b(r.$$.fragment,a),o=!0)},o(a){y(r.$$.fragment,a),o=!1},d(a){a&&p(t),F(r)}}}function kt(s){let e,t,r,n,o,u,a,l,f,c=s[2].length+"",v,_,h,g,m,i=s[1]&&Ue(s);const j=[ct,ut],O=[];function T(k,V){return k[3]?0:1}n=T(s),o=O[n]=j[n](s);const X=[vt,gt],z=[];function Z(k,V){return k[2].length>0?0:1}return h=Z(s),g=z[h]=X[h](s),{c(){e=E("div"),t=E("div"),i&&i.c(),r=P(),o.c(),u=P(),a=E("div"),l=E("pre"),f=K("Comments: "),v=K(c),_=P(),g.c(),this.h()},l(k){e=S(k,"DIV",{class:!0});var V=A(e);t=S(V,"DIV",{class:!0});var R=A(t);i&&i.l(R),r=B(R),o.l(R),u=B(R),a=S(R,"DIV",{class:!0});var Y=A(a);l=S(Y,"PRE",{class:!0});var G=A(l);f=J(G,"Comments: "),v=J(G,c),G.forEach(p),_=B(Y),g.l(Y),Y.forEach(p),R.forEach(p),V.forEach(p),this.h()},h(){w(l,"class","text-xs"),w(a,"class","flex flex-col justify-center pt-4"),w(t,"class","w-full lg:w-2/3"),w(e,"class","flex flex-col items-center bg-change dark:bg-dark shifting p-4 lg:p-8")},m(k,V){C(k,e,V),$(e,t),i&&i.m(t,null),$(t,r),O[n].m(t,null),$(t,u),$(t,a),$(a,l),$(l,f),$(l,v),$(a,_),z[h].m(a,null),m=!0},p(k,[V]){k[1]?i?(i.p(k,V),V&2&&b(i,1)):(i=Ue(k),i.c(),b(i,1),i.m(t,r)):i&&(ee(),y(i,1,1,()=>{i=null}),te());let R=n;n=T(k),n===R?O[n].p(k,V):(ee(),y(O[R],1,1,()=>{O[R]=null}),te(),o=O[n],o?o.p(k,V):(o=O[n]=j[n](k),o.c()),b(o,1),o.m(t,u)),(!m||V&4)&&c!==(c=k[2].length+"")&&x(v,c);let Y=h;h=Z(k),h===Y?z[h].p(k,V):(ee(),y(z[Y],1,1,()=>{z[Y]=null}),te(),g=z[h],g?g.p(k,V):(g=z[h]=X[h](k),g.c()),b(g,1),g.m(a,null))},i(k){m||(b(i),b(o),b(g),m=!0)},o(k){y(i),y(o),y(g),m=!1},d(k){k&&p(e),i&&i.d(),O[n].d(),z[h].d()}}}function Ot(s){return!s||!Array.isArray(s)?[]:s.map(t=>{var r;return{...t,replies:((r=t.replies)==null?void 0:r.map(n=>({...n,parentCommentId:t.id})))||[]}})}function Ct(s,e,t){let r,n;ke(s,Ce,m=>t(8,r=m)),ke(s,Je,m=>t(3,n=m));let{data:o}=e,u="",a,l=!1,f=null,c=[],v;Ve(async()=>{try{const m=await fetch(`${ne}/api/posts/getForPostDetails/${o.id}`);if(!m.ok)throw new Error("Failed to fetch post details");const i=await m.json();et({id:i.id,...i,mysteryObject:i.mysteryObject?{description:i.mysteryObject.description,writtenText:i.mysteryObject.writtenText,color:i.mysteryObject.color,shape:i.mysteryObject.shape,descriptionOfParts:i.mysteryObject.descriptionOfParts,location:i.mysteryObject.location,hardness:i.mysteryObject.hardness,timePeriod:i.mysteryObject.timePeriod,smell:i.mysteryObject.smell,taste:i.mysteryObject.taste,texture:i.mysteryObject.texture,value:i.mysteryObject.value,originOfAcquisition:i.mysteryObject.originOfAcquisition,pattern:i.mysteryObject.pattern,brand:i.mysteryObject.brand,print:i.mysteryObject.print,functionality:i.mysteryObject.functionality,imageLicenses:i.mysteryObject.imageLicenses,markings:i.mysteryObject.markings,handmade:i.mysteryObject.handmade,oneOfAKind:i.mysteryObject.oneOfAKind,sizeX:i.mysteryObject.sizeX,sizeY:i.mysteryObject.sizeY,sizeZ:i.mysteryObject.sizeZ,weight:i.mysteryObject.weight,item_condition:i.mysteryObject.item_condition}:null,title:i.title,description:i.description,tags:i.tags||[],author:i.author,createdAt:i.createdAt,updatedAt:i.updatedAt,upvotes:i.upvotes,downvotes:i.downvotes,userUpvoted:i.userUpvoted,userDownvoted:i.userDownvoted,solved:i.solved,comments:[]}),await _(),v=async j=>{var O;((O=j.detail)==null?void 0:O.threadId)===o.id&&await _()},document.addEventListener("refreshComments",v)}catch(m){console.error("Error fetching thread data:",m)}}),We(()=>{v&&document.removeEventListener("refreshComments",v)});async function _(){try{const m=await fetch(`${ne}/api/comments/get/${o.id}`,{headers:{...me()}});if(!m.ok)throw new Error("Failed to fetch comments");const i=await m.json(),j=Ot(i);Ce.update(O=>O.map(T=>T.id==o.id?{...T,comments:j}:T))}catch(m){console.error("Error refreshing comments:",m)}}let h=async()=>{if(!u.trim()){console.error("Comment cannot be empty");return}t(5,l=!0),t(6,f=null);try{const m={content:u,postId:o.id,parentCommentId:null},i=await fetch(`${ne}/api/comments/create`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("authToken")?`Bearer ${localStorage.getItem("authToken")}`:""},body:JSON.stringify(m)});if(!i.ok){const O=await i.text();throw new Error(`Failed to add comment: ${O}`)}const j=await i.json();await _(),t(4,u="")}catch(m){console.error("Error submitting comment:",m),t(6,f=m.message||"Failed to submit comment")}finally{t(5,l=!1)}};function g(m){u=m,t(4,u)}return s.$$set=m=>{"data"in m&&t(0,o=m.data)},s.$$.update=()=>{s.$$.dirty&8,s.$$.dirty&257&&t(1,a=r.find(m=>m.id==o.id)),s.$$.dirty&2&&(a!=null&&a.comments?t(2,c=a.comments):t(2,c=[])),s.$$.dirty&6&&a&&c.length>0},[o,a,c,n,u,l,f,h,r,g]}class Lt extends Me{constructor(e){super(),Fe(this,e,Ct,kt,ze,{data:0})}}export{Lt as component,Nt as universal};
