import{s as st,e as h,c as b,b as A,f as g,l as _,i as le,h as d,m as at,p as nt,k as lt,o as it,q as X,a as j,t as ge,g as P,r as me,d as he,u as Z,j as Ve,n as rt}from"../chunks/DhMr5c2G.js";import{S as ot,i as ut,c as K,a as Q,m as H,t as W,b as G,d as ee,e as B}from"../chunks/D_SvASXj.js";import{C as dt,a as ct}from"../chunks/DtBTuCuf.js";import{O as ft,Q as pt,M as mt}from"../chunks/vtNuVVIe.js";import{t as gt}from"../chunks/DmlDi6gt.js";import{g as ht}from"../chunks/F-ohFSWW.js";import{a as bt}from"../chunks/OLZfEaQC.js";import{T as Je,M as _t}from"../chunks/C0vSs4Ow.js";import{B as $t}from"../chunks/BNST9Elv.js";function yt(e){let n,s,l="Fill in the details about your object, you can leave any blank if you are not sure, but try to be as precise as possible";return{c(){n=ge(`Let's help you post new stuff\r
                `),s=h("small"),s.textContent=l,this.h()},l(a){n=he(a,`Let's help you post new stuff\r
                `),s=b(a,"SMALL",{class:!0,"data-svelte-h":!0}),me(s)!=="svelte-1b6x60p"&&(s.textContent=l),this.h()},h(){_(s,"class","block text-xs sm:text-sm mt-1 sm:mt-2 font-semibold opacity-80")},m(a,o){le(a,n,o),le(a,s,o)},p:rt,d(a){a&&(g(n),g(s))}}}function Re(e){let n,s=e[8].title+"",l;return{c(){n=h("p"),l=ge(s),this.h()},l(a){n=b(a,"P",{class:!0});var o=A(n);l=he(o,s),o.forEach(g),this.h()},h(){_(n,"class","text-red-500 text-sm mt-1")},m(a,o){le(a,n,o),d(n,l)},p(a,o){o&256&&s!==(s=a[8].title+"")&&Ve(l,s)},d(a){a&&g(n)}}}function Xe(e){let n,s=e[8].description+"",l;return{c(){n=h("p"),l=ge(s),this.h()},l(a){n=b(a,"P",{class:!0});var o=A(n);l=he(o,s),o.forEach(g),this.h()},h(){_(n,"class","text-red-500 text-sm mt-1")},m(a,o){le(a,n,o),d(n,l)},p(a,o){o&256&&s!==(s=a[8].description+"")&&Ve(l,s)},d(a){a&&g(n)}}}function vt(e){let n;return{c(){n=ge("Post Your Stuff")},l(s){n=he(s,"Post Your Stuff")},m(s,l){le(s,n,l)},d(s){s&&g(n)}}}function wt(e){let n,s,l,a,o,O="Title*",p,f,$,z,te,m,D,ke="Description*",be,C,_e,$e,ye,L,se,k,ve,we,Oe,V,i,I,c="Tags",ce,ae,F=e[2].length+"",fe,N,x,r,y,E,S,q,ie,Ie="Object Parts (Optional)",Ae,re,qe="You can add parts to your mystery object if it consists of multiple components.",Fe,U,Ee,Ce,T,xe,Se,Te,je,Y,Pe;n=new ct({props:{class:"p-3 sm:p-4 text-xl sm:text-2xl mt-4 sm:mt-6 text-center",$$slots:{default:[yt]},$$scope:{ctx:e}}});function Ze(t){e[15](t)}let Ue={id:"title",class:"w-full p-2 border rounded dark:border-gray-600 h-auto text-base",placeholder:"This is what people will see on their homepage so try to make it interesting"};e[1]!==void 0&&(Ue.value=e[1]),f=new Je({props:Ue}),X.push(()=>B(f,"value",Ze));let v=e[8].title&&Re(e);function Be(t){e[16](t)}let Ne={id:"description",class:"w-full p-2 mb-4 border rounded dark:border-gray-600 h-32",placeholder:"You can add any additional context about your object or how you came into possession of it."};e[4]!==void 0&&(Ne.value=e[4]),C=new Je({props:Ne}),X.push(()=>B(C,"value",Be));let w=e[8].description&&Xe(e);function Ke(t){e[17](t)}function Qe(t){e[18](t)}let ze={};e[6]!==void 0&&(ze.attributeValues=e[6]),e[7]!==void 0&&(ze.activeAttributes=e[7]),k=new ft({props:ze}),X.push(()=>B(k,"attributeValues",Ke)),X.push(()=>B(k,"activeAttributes",Qe)),k.$on("update",e[10]),k.$on("valuechange",e[11]);function He(t){e[19](t)}function We(t){e[20](t)}let De={};e[2]!==void 0&&(De.tags=e[2]),e[3]!==void 0&&(De.labels=e[3]),r=new pt({props:De}),X.push(()=>B(r,"tags",He)),X.push(()=>B(r,"labels",We));function Ge(t){e[21](t)}let Ye={mysteryObjectId:null};e[5]!==void 0&&(Ye.subParts=e[5]),U=new mt({props:Ye}),X.push(()=>B(U,"subParts",Ge)),U.$on("update",e[13]);function et(t){e[22](t)}function tt(t){e[23](t)}let Le={};return e[0]!==void 0&&(Le.mediaFiles=e[0]),e[8]!==void 0&&(Le.errors=e[8]),T=new _t({props:Le}),X.push(()=>B(T,"mediaFiles",et)),X.push(()=>B(T,"errors",tt)),T.$on("update",e[9]),Y=new $t({props:{variant:"outline",size:"icon",class:"w-full p-2 border rounded mb-4 transition-all hover:bg-rose-900 flex justify-center items-center gap-2",$$slots:{default:[vt]},$$scope:{ctx:e}}}),Y.$on("click",e[12]),{c(){K(n.$$.fragment),s=j(),l=h("div"),a=h("div"),o=h("label"),o.textContent=O,p=j(),K(f.$$.fragment),z=j(),v&&v.c(),te=j(),m=h("div"),D=h("label"),D.textContent=ke,be=j(),K(C.$$.fragment),$e=j(),w&&w.c(),ye=j(),L=h("div"),se=h("div"),K(k.$$.fragment),Oe=j(),V=h("div"),i=h("label"),I=h("span"),I.textContent=c,ce=j(),ae=h("span"),fe=ge(F),N=ge(" added"),x=j(),K(r.$$.fragment),S=j(),q=h("div"),ie=h("h3"),ie.textContent=Ie,Ae=j(),re=h("p"),re.textContent=qe,Fe=j(),K(U.$$.fragment),Ce=j(),K(T.$$.fragment),Te=j(),je=h("div"),K(Y.$$.fragment),this.h()},l(t){Q(n.$$.fragment,t),s=P(t),l=b(t,"DIV",{class:!0});var u=A(l);a=b(u,"DIV",{class:!0});var M=A(a);o=b(M,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),me(o)!=="svelte-1yfolbh"&&(o.textContent=O),p=P(M),Q(f.$$.fragment,M),z=P(M),v&&v.l(M),M.forEach(g),te=P(u),m=b(u,"DIV",{class:!0});var J=A(m);D=b(J,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),me(D)!=="svelte-1hpburp"&&(D.textContent=ke),be=P(J),Q(C.$$.fragment,J),$e=P(J),w&&w.l(J),J.forEach(g),ye=P(u),L=b(u,"DIV",{class:!0});var oe=A(L);se=b(oe,"DIV",{class:!0});var pe=A(se);Q(k.$$.fragment,pe),pe.forEach(g),Oe=P(oe),V=b(oe,"DIV",{class:!0});var ne=A(V);i=b(ne,"LABEL",{class:!0});var ue=A(i);I=b(ue,"SPAN",{"data-svelte-h":!0}),me(I)!=="svelte-fsa5fj"&&(I.textContent=c),ce=P(ue),ae=b(ue,"SPAN",{class:!0});var de=A(ae);fe=he(de,F),N=he(de," added"),de.forEach(g),ue.forEach(g),x=P(ne),Q(r.$$.fragment,ne),ne.forEach(g),oe.forEach(g),S=P(u),q=b(u,"DIV",{class:!0});var R=A(q);ie=b(R,"H3",{class:!0,"data-svelte-h":!0}),me(ie)!=="svelte-1xdwn8u"&&(ie.textContent=Ie),Ae=P(R),re=b(R,"P",{class:!0,"data-svelte-h":!0}),me(re)!=="svelte-s7i1uj"&&(re.textContent=qe),Fe=P(R),Q(U.$$.fragment,R),R.forEach(g),Ce=P(u),Q(T.$$.fragment,u),Te=P(u),je=b(u,"DIV",{});var Me=A(je);Q(Y.$$.fragment,Me),Me.forEach(g),u.forEach(g),this.h()},h(){_(o,"for","title"),_(o,"class","block text-sm font-medium mb-1.5"),_(a,"class","mb-5"),_(D,"for","description"),_(D,"class","block text-sm font-medium mb-1.5"),_(m,"class","mb-5"),_(se,"class","w-full lg:w-1/2"),_(ae,"class","ml-2 px-2 py-0.5 bg-gray-100 dark:bg-gray-800 text-xs rounded-full"),_(i,"class","lg:block text-sm font-medium mb-1.5 flex items-center"),_(V,"class","w-full lg:w-1/2 mb-5"),_(L,"class","flex flex-col lg:flex-row lg:gap-6"),_(ie,"class","block text-sm font-medium mb-3"),_(re,"class","text-sm text-neutral-500 mb-4"),_(q,"class","mb-5"),_(l,"class","bg-opacity-95 rounded-lg shadow-lg p-4 sm:p-6")},m(t,u){H(n,t,u),le(t,s,u),le(t,l,u),d(l,a),d(a,o),d(a,p),H(f,a,null),d(a,z),v&&v.m(a,null),d(l,te),d(l,m),d(m,D),d(m,be),H(C,m,null),d(m,$e),w&&w.m(m,null),d(l,ye),d(l,L),d(L,se),H(k,se,null),d(L,Oe),d(L,V),d(V,i),d(i,I),d(i,ce),d(i,ae),d(ae,fe),d(ae,N),d(V,x),H(r,V,null),d(l,S),d(l,q),d(q,ie),d(q,Ae),d(q,re),d(q,Fe),H(U,q,null),d(l,Ce),H(T,l,null),d(l,Te),d(l,je),H(Y,je,null),Pe=!0},p(t,u){const M={};u&536870912&&(M.$$scope={dirty:u,ctx:t}),n.$set(M);const J={};!$&&u&2&&($=!0,J.value=t[1],Z(()=>$=!1)),f.$set(J),t[8].title?v?v.p(t,u):(v=Re(t),v.c(),v.m(a,null)):v&&(v.d(1),v=null);const oe={};!_e&&u&16&&(_e=!0,oe.value=t[4],Z(()=>_e=!1)),C.$set(oe),t[8].description?w?w.p(t,u):(w=Xe(t),w.c(),w.m(m,null)):w&&(w.d(1),w=null);const pe={};!ve&&u&64&&(ve=!0,pe.attributeValues=t[6],Z(()=>ve=!1)),!we&&u&128&&(we=!0,pe.activeAttributes=t[7],Z(()=>we=!1)),k.$set(pe),(!Pe||u&4)&&F!==(F=t[2].length+"")&&Ve(fe,F);const ne={};!y&&u&4&&(y=!0,ne.tags=t[2],Z(()=>y=!1)),!E&&u&8&&(E=!0,ne.labels=t[3],Z(()=>E=!1)),r.$set(ne);const ue={};!Ee&&u&32&&(Ee=!0,ue.subParts=t[5],Z(()=>Ee=!1)),U.$set(ue);const de={};!xe&&u&1&&(xe=!0,de.mediaFiles=t[0],Z(()=>xe=!1)),!Se&&u&256&&(Se=!0,de.errors=t[8],Z(()=>Se=!1)),T.$set(de);const R={};u&536870912&&(R.$$scope={dirty:u,ctx:t}),Y.$set(R)},i(t){Pe||(W(n.$$.fragment,t),W(f.$$.fragment,t),W(C.$$.fragment,t),W(k.$$.fragment,t),W(r.$$.fragment,t),W(U.$$.fragment,t),W(T.$$.fragment,t),W(Y.$$.fragment,t),Pe=!0)},o(t){G(n.$$.fragment,t),G(f.$$.fragment,t),G(C.$$.fragment,t),G(k.$$.fragment,t),G(r.$$.fragment,t),G(U.$$.fragment,t),G(T.$$.fragment,t),G(Y.$$.fragment,t),Pe=!1},d(t){t&&(g(s),g(l)),ee(n,t),ee(f),v&&v.d(),ee(C),w&&w.d(),ee(k),ee(r),ee(U),ee(T),ee(Y)}}}function Ot(e){let n,s,l,a,o,O;return l=new dt({props:{class:"bg-opacity-90 shadow-xl",$$slots:{default:[wt]},$$scope:{ctx:e}}}),{c(){n=h("div"),s=h("form"),K(l.$$.fragment),this.h()},l(p){n=b(p,"DIV",{class:!0});var f=A(n);s=b(f,"FORM",{class:!0});var $=A(s);Q(l.$$.fragment,$),$.forEach(g),f.forEach(g),this.h()},h(){_(s,"class","w-full lg:w-2/3"),_(n,"class","flex justify-center p-3 sm:p-6 lg:py-10 bg-change dark:bg-dark shifting")},m(p,f){le(p,n,f),d(n,s),H(l,s,null),a=!0,o||(O=at(s,"submit",nt(e[12])),o=!0)},p(p,[f]){const $={};f&536871423&&($.$$scope={dirty:f,ctx:p}),l.$set($)},i(p){a||(W(l.$$.fragment,p),a=!0)},o(p){G(l.$$.fragment,p),a=!1},d(p){p&&g(n),ee(l),o=!1,O()}}}async function jt(e){var s,l,a;const n=`https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${e}&format=json&languages=en&origin=*`;try{const p=(a=(l=(s=(await(await fetch(n)).json()).entities[e])==null?void 0:s.labels)==null?void 0:l.en)==null?void 0:a.value;if(!p)throw new Error(`Label not found for qcode: ${e}`);return p}catch(o){return console.error("Error fetching label:",o),null}}async function Pt(e){const n=[];for(const s of e){const l=await jt(s.id);l&&n.push({id:s.id,label:l})}return n}function kt(e){return{description:e.description||"",material:e.material||null,color:e.color||null,shape:e.shape||null,location:e.location||null,smell:e.smell||null,taste:e.taste||null,texture:e.texture||null,functionality:e.functionality||null,markings:e.markings||null,handmade:e.handmade||!1,oneOfAKind:e.oneOfAKind||!1,weight:e.weight?parseFloat(e.weight):null,timePeriod:e.timePeriod||null,writtenText:e.writtenText||null,descriptionOfParts:e.descriptionOfParts||null,hardness:e.hardness||null,value:e.value?parseFloat(e.value):null,originOfAcquisition:e.originOfAcquisition||null,pattern:e.pattern||null,brand:e.brand||null,print:e.print||null,imageLicenses:e.imageLicenses||null,sizeX:e.sizeX?parseFloat(e.sizeX):null,sizeY:e.sizeY?parseFloat(e.sizeY):null,sizeZ:e.sizeZ?parseFloat(e.sizeZ):null,item_condition:e.item_condition||null}}function At(e,n,s){let l;lt(e,bt,i=>s(14,l=i));let a=[],o="",O=[],p=[],f="",$=[],z={material:"",shape:"",color:"",texture:"",weight:"",smell:"",taste:"",marking:"",functionality:"",period:"",location:"",writtenText:"",descriptionOfParts:"",hardness:"",value:"",originOfAcquisition:"",pattern:"",brand:"",print:"",imageLicenses:"",sizeX:"",sizeY:"",sizeZ:"",itemCondition:"",handmade:!1,oneOfAKind:!1},te=[],m={title:"",media:"",description:""};function D(i){s(0,a=i.detail.mediaFiles)}function ke(i){s(7,te=i.detail.activeAttributes)}function be(i){s(6,z=i.detail.attributeValues)}let C=async()=>{s(8,m={title:"",media:"",description:""});let i=!1;if(o.trim()||(s(8,m.title="Title is required",m),i=!0),a.length===0&&(s(8,m.media="At least one media file is required",m),i=!0),f.trim()||(s(8,m.description="Description is required",m),i=!0),!i)try{const I=await Pt(O),c=JSON.parse(JSON.stringify(z)),ce={description:f,material:c.material||null,color:c.colorHex||null,shape:c.shape||null,location:c.location||null,smell:c.smell||null,taste:c.taste||c.smell||null,texture:c.texture||null,functionality:c.functionality||null,markings:c.marking||null,handmade:c.handmade||!1,oneOfAKind:c.oneOfAKind||!1,weight:parseFloat(c.weight)||null,timePeriod:c.period||null,writtenText:c.writtenText||null,descriptionOfParts:c.descriptionOfParts||null,hardness:c.hardness||null,value:parseFloat(c.value)||null,originOfAcquisition:c.originOfAcquisition||null,pattern:c.pattern||null,brand:c.brand||null,print:c.print||null,imageLicenses:c.imageLicenses||null,sizeX:parseFloat(c.sizeX)||null,sizeY:parseFloat(c.sizeY)||null,sizeZ:parseFloat(c.sizeZ)||null,item_condition:c.itemCondition||null},ae=z.color,F=new FormData;if(F.append("title",o),F.append("content",f),O&&O.length>0){const r=O.map(y=>y.id);F.append("tags",JSON.stringify(r))}else F.append("tags",JSON.stringify([]));if(F.append("mysteryObject",JSON.stringify(ce)),a.length>0){const r=a[0].file;F.append("image",r)}const fe={title:o,content:f,tags:O.map(r=>r.id),mysteryObject:ce};console.log("Creating post with JSON data");const N=await fetch("https://backend-310608491068.europe-west1.run.app/api/posts/create-json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(fe),credentials:"include"});if(!N.ok){let r=`Failed to create post: ${N.status} ${N.statusText}`;try{const y=await N.json();y.message&&(r=y.message)}catch(y){console.error("Error parsing response:",y)}throw new Error(r)}const x=await N.json();if(console.log("Post created successfully:",x),a.length>0){const r=new FormData;r.append("file",a[0].file),console.log("Uploading main image");try{await fetch(`https://backend-310608491068.europe-west1.run.app/api/posts/${x.postId}/mysteryObjects/${x.mysteryObjectId}/set-image`,{method:"POST",body:r,credentials:"include"})}catch(y){console.error("Error uploading main image:",y)}}if(console.log("Post created successfully:",x),a.length>0){console.log(`Uploading ${a.length} media files`);for(let r=0;r<a.length;r++){const y=a[r],E=new FormData;E.append("file",y.file),E.append("type",y.type||"image");try{console.log(`Uploading media file ${r+1}/${a.length}`);const S=await fetch(`https://backend-310608491068.europe-west1.run.app/api/mysteryObjects/${x.mysteryObjectId}/upload-media`,{method:"POST",body:E,credentials:"include"});S.ok?console.log(`Media file ${r+1} uploaded successfully`):console.error(`Failed to upload media file ${r+1}:`,S.status,S.statusText)}catch(S){console.error(`Error uploading media file ${r+1}:`,S)}}}if($.length>0){console.log(`Adding ${$.length} sub-parts to mystery object`);for(let r=0;r<$.length;r++)try{console.log(`Adding sub-part ${r+1}/${$.length}`);const y=kt($[r]),E=await fetch(`https://backend-310608491068.europe-west1.run.app/api/mysteryObjects/${x.mysteryObjectId}/subParts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y),credentials:"include"});if(E.ok)console.log(`Sub-part ${r+1} added successfully`);else{console.error(`Failed to add sub-part ${r+1}:`,E.status,E.statusText);const S=await E.text();console.error("Error response:",S)}}catch(y){console.error(`Error adding sub-part ${r+1}:`,y)}}gt.update(r=>[...r,x]),ht("/")}catch(I){console.error("Error creating post:",I),alert(`Failed to create post: ${I.message}`)}};it(()=>{for(const i of a)i.url&&URL.revokeObjectURL(i.url)});function _e(i){s(5,$=i.detail.subParts)}function $e(i){o=i,s(1,o)}function ye(i){f=i,s(4,f)}function L(i){z=i,s(6,z)}function se(i){te=i,s(7,te)}function k(i){O=i,s(2,O)}function ve(i){p=i,s(3,p)}function we(i){$=i,s(5,$)}function Oe(i){a=i,s(0,a)}function V(i){m=i,s(8,m)}return e.$$.update=()=>{e.$$.dirty&16384},[a,o,O,p,f,$,z,te,m,D,ke,be,C,_e,l,$e,ye,L,se,k,ve,we,Oe,V]}class Vt extends ot{constructor(n){super(),ut(this,n,At,Ot,st,{})}}export{Vt as component};
