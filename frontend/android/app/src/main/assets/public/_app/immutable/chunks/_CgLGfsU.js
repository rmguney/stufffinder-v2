import{w as l}from"./C34h2UdL.js";import{g as i}from"./RSIJn0f_.js";import{a as w}from"./BC_TeMzq.js";const a=l([]),k=l(0);let u="";function m(t){const o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}async function f(){try{if(!m("tokenKey"))return;w.subscribe(h=>{u=h});const e=u;if(!e)return;const o=await fetch(`https://backend-310608491068.europe-west1.run.app/api/auth/username/${e}`,{headers:i()});if(!o.ok)throw new Error("Failed to get user ID");const d=(await o.json()).userId,s=await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${d}`,{headers:i()});if(!s.ok)throw new Error("Failed to fetch notifications");const c=await s.json();a.set(c),p(c)}catch(t){console.error("Error fetching notifications:",t)}}async function g(t){try{if(!(await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${t}/read`,{method:"PUT",headers:i()})).ok)throw new Error("Failed to mark notification as read");a.update(o=>o.map(n=>n.id===t?{...n,isRead:!0}:n)),a.subscribe(o=>{p(o)})()}catch(e){console.error("Error marking notification as read:",e)}}async function I(){try{const t=get(a);for(const e of t)e.isRead||await g(e.id)}catch(t){console.error("Error marking all notifications as read:",t)}}function p(t){const e=t.filter(o=>!o.isRead).length;k.set(e)}let r;function R(){r&&clearInterval(r),f(),r=setInterval(f,6e4)}function E(){r&&(clearInterval(r),r=null)}export{I as a,R as b,f,g as m,a as n,E as s,k as u};
