import{g as n}from"./RSIJn0f_.js";import{a as h}from"./CpPhVZOh.js";import{d as k,w as u}from"./CTHOJFrz.js";import{P as m}from"./C6oXrJZt.js";const s=u([]),g=u(0),f=u([]),b=u(0);let l="";function y(t){const e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}async function w(){try{if(!y("tokenKey"))return;h.subscribe(p=>{l=p});const o=l;if(!o)return;const e=await fetch(`https://backend-310608491068.europe-west1.run.app/api/auth/username/${o}`,{headers:n()});if(!e.ok)throw new Error("Failed to get user ID");const d=(await e.json()).userId,i=await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${d}`,{headers:n()});if(!i.ok)throw new Error("Failed to fetch notifications");const c=await i.json();s.set(c),E(c)}catch(t){console.error("Error fetching notifications:",t)}}async function I(){try{if(!y("tokenKey"))return;h.subscribe(p=>{l=p});const o=l;if(!o)return;const e=await fetch(`https://backend-310608491068.europe-west1.run.app/api/auth/username/${o}`,{headers:n()});if(!e.ok)throw new Error("Failed to get user ID");const d=(await e.json()).userId,i=await fetch(`https://backend-310608491068.europe-west1.run.app/api/follower-notifications/${d}`,{headers:n()});if(!i.ok)throw new Error("Failed to fetch follower notifications");const c=await i.json();f.set(c),F(c)}catch(t){console.error("Error fetching follower notifications:",t)}}async function R(t){try{if(!(await fetch(`https://backend-310608491068.europe-west1.run.app/api/notifications/${t}/read`,{method:"PUT",headers:n()})).ok)throw new Error("Failed to mark notification as read");s.update(e=>e.map(r=>r.id===t?{...r,isRead:!0}:r)),s.subscribe(e=>{E(e)})()}catch(o){console.error("Error marking notification as read:",o)}}async function v(t){try{if(!(await fetch(`https://backend-310608491068.europe-west1.run.app/api/follower-notifications/${t}/read`,{method:"PUT",headers:n()})).ok)throw new Error("Failed to mark follower notification as read");f.update(e=>e.map(r=>r.id===t?{...r,read:!0}:r)),f.subscribe(e=>{F(e)})()}catch(o){console.error("Error marking follower notification as read:",o)}}async function U(){try{console.log(s);const t=m(s);for(const o of t)o.isRead||await R(o.id);w()}catch(t){console.error("Error marking all notifications as read:",t)}}async function C(){try{const t=m(f);for(const o of t)o.read||await v(o.id);I()}catch(t){console.error("Error marking all follower notifications as read:",t)}}function E(t){const o=t.filter(e=>!e.isRead).length;g.set(o)}function F(t){const o=t.filter(e=>!e.read).length;b.set(o)}let a;function P(){a&&clearInterval(a),w(),a=setInterval(w,6e4)}function j(){a&&(clearInterval(a),a=null)}const K=k([s,f],([t,o])=>[...t,...o].sort((e,r)=>new Date(r.createdAt)-new Date(e.createdAt))),T=k([g,b],([t,o])=>t+o);export{U as a,T as b,b as c,K as d,P as e,I as f,v as g,C as h,w as i,R as m,s as n,j as s,g as u};
